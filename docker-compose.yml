version: "3.7"

services:

#
# MySQL database services
#  --skip-ssl options must remain
#  a custom root password for the root database user can be set in a .env file
#
    database:
        build:
            context: ./mysql
        environment:
            - MYSQL_ROOT_PASSWORD=${LOCAL_MYSQL_ROOT_PASSWORD}
        command: --skip-ssl
        image: sql_backend:0.1
        container_name: ${DB_SERVICE_NAME}
        networks:
            - library-net
#        volumes:
#            - "./data:/var/lib/mysql"
#
# Catalog REST database interface service
#
    catalog:
        build:
            context: ./flask-services/src/catalogdbservice
        command: --host ${LOCAL_HOST} --db ${DB_SERVICE_NAME}
        depends_on:
            - database
        image: catalog_db:0.1
        container_name: ${CATALOG_DB_SERVICE_NAME}
        networks:
            - library-net
        ports:
            - "8001:5001"
#
# Borrowing REST database interface service
#
    borrow:
        build:
            context: ./flask-services/src/borrowingdbservice
        command: --host ${LOCAL_HOST} --db ${DB_SERVICE_NAME}
        depends_on:
            - database
        image: borrowing_db:0.1
        container_name: ${BORROW_DB_SERVICE_NAME}
        networks:
            - library-net
        ports:
            - "8002:5002"
#
# Web front end
#  a custom local host IP address should be provided in the .env file
#  this is the web front end access address for your local browser.
#  service names are added via environment variables, a Django hack to use command line
#  variable is preferred but not implemented here.
#
    frontend:
        build:
            context: ./django-frontend
        environment:
            - CATALOG_DB_SERVICE=${CATALOG_DB_SERVICE_NAME}
            - BORROW_DB_SERVICE=${BORROW_DB_SERVICE_NAME}
            - BORROW_LOGIC_SERVICE=${BORROW_LOGIC_SERVICE_NAME}
        command: ${LOCAL_HOST}:8000
        depends_on:
            - database
            - catalog
            - borrow
        image: web_frontend:0.1
        container_name: ${FRONTEND_SERVICE_NAME}
        networks:
            - library-net
        ports:
            - "8000:8000"

networks:
    library-net:
        driver: bridge
    